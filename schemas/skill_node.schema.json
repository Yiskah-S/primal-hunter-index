{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://primal-hunter.local/schemas/skill_node.schema.json",
  "title": "Skill Node",
  "$comment": "See docs/contracts/skills_contract_v1.0.md#22-skill-node-sn",
  "type": "object",
  "$defs": {
    "stat_synergy": {
      "type": "object",
      "description": "Numeric scaling factors or qualitative stat relationships.",
      "patternProperties": {
        "^[A-Za-z0-9_]+$": {
          "type": [
            "number",
            "string"
          ]
        }
      },
      "additionalProperties": false
    },
    "effects": {
      "type": "object",
      "description": "Canonical effect payload for this skill manifestation.",
      "properties": {
        "stat_synergy": {
          "$ref": "#/$defs/stat_synergy"
        },
        "param_rule": {
          "$ref": "https://primal-hunter.local/schemas/shared/param_rule.schema.json#/$defs/param_rule"
        },
        "proficiency_with": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "uniqueItems": true
        },
        "passive_benefit": {
          "type": "string"
        },
        "notes": {
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "lineage": {
      "type": "object",
      "description": "In-world evolution metadata for the node.",
      "properties": {
        "evolves_from": {
          "allOf": [
            {
              "$ref": "https://primal-hunter.local/schemas/shared/id.schema.json"
            },
            {
              "pattern": "^sn\\."
            }
          ],
          "description": "Immediate predecessor node identifier."
        },
        "related_to": {
          "type": "array",
          "items": {
            "allOf": [
              {
                "$ref": "https://primal-hunter.local/schemas/shared/id.schema.json"
              },
              {
                "pattern": "^sn\\."
              }
            ]
          },
          "uniqueItems": true,
          "description": "Variant siblings or fused manifestations."
        },
        "notes": {
          "type": "string",
          "description": "Narrative commentary explaining the relationship."
        }
      },
      "additionalProperties": false
    }
  },
  "required": [
    "node_id",
    "family_id",
    "rarity",
    "effects",
    "granted_by",
    "source_ref",
    "record_log"
  ],
  "properties": {
    "node_id": {
      "allOf": [
        {
          "$ref": "https://primal-hunter.local/schemas/shared/id.schema.json"
        },
        {
          "pattern": "^sn\\."
        }
      ],
      "description": "Stable identifier for the skill node (sn.*)."
    },
    "family_id": {
      "allOf": [
        {
          "$ref": "https://primal-hunter.local/schemas/shared/id.schema.json"
        },
        {
          "pattern": "^sf\\."
        }
      ],
      "description": "Parent skill family identifier (sf.*)."
    },
    "rarity": {
      "type": "string",
      "enum": [
        "Inferior",
        "Common",
        "Uncommon",
        "Rare",
        "Epic",
        "Legendary",
        "Unique",
        "Transcendent"
      ],
      "description": "Canonical rarity tier of the node."
    },
    "flavor": {
      "$ref": "https://primal-hunter.local/schemas/shared/flavor.schema.json#/$defs/flavor"
    },
    "effects": {
      "$ref": "#/$defs/effects"
    },
    "granted_by": {
      "$ref": "https://primal-hunter.local/schemas/shared/granted_by.schema.json#/$defs/granted_by"
    },
    "source_ref": {
      "$ref": "https://primal-hunter.local/schemas/shared/provenance.schema.json#/$defs/source_ref_array",
      "description": "Provenance entries documenting this manifestation."
    },
    "record_log": {
      "$ref": "https://primal-hunter.local/schemas/shared/record_log.schema.json#/$defs/record_log",
      "description": "Audit history per the Record Log contract."
    },
    "lineage": {
      "$ref": "#/$defs/lineage"
    },
    "tags": {
      "type": "array",
      "description": "Eventual tag IDs linked to this node.",
      "items": {
        "type": "string",
        "pattern": "^tag\\.[a-z0-9_]+(\\.[a-z0-9_]+)*$"
      },
      "uniqueItems": true
    },
    "notes": {
      "type": "string",
      "description": "Optional maintainer notes."
    }
  },
  "additionalProperties": false
}
