{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Timeline Event",
  "description": "Represents a change in a character's state over time, such as acquiring a skill, leveling up, or observing a stat.",
  "type": "object",
  "$comment": "See docs/contracts/provenance_contract_v2.0.md#2-provenance-requirements",
  "required": [
    "event_id",
    "type",
    "character",
    "source_ref"
  ],
  "properties": {
    "event_id": {
      "allOf": [
        {
          "$ref": "https://primal-hunter.local/schemas/shared/id.schema.json"
        },
        {
          "pattern": "^ev\\."
        }
      ],
      "description": "Stable event identifier (ev.character.scene.suffix)."
    },
    "type": {
      "type": "string",
      "description": "Type of event (e.g., skill_acquired, skill_upgraded, param_observed, class_changed, tier_changed)"
    },
    "character": {
      "allOf": [
        {
          "$ref": "https://primal-hunter.local/schemas/shared/id.schema.json"
        },
        {
          "pattern": "^pc\\."
        }
      ],
      "description": "Character stable ID (pc.*)."
    },
    "family_id": {
      "allOf": [
        {
          "$ref": "https://primal-hunter.local/schemas/shared/id.schema.json"
        },
        {
          "pattern": "^sf\\."
        }
      ],
      "description": "Skill family affected by this event."
    },
    "node_id": {
      "allOf": [
        {
          "$ref": "https://primal-hunter.local/schemas/shared/id.schema.json"
        },
        {
          "pattern": "^sn\\."
        }
      ],
      "description": "Skill node affected by this event."
    },
    "param": {
      "type": "string",
      "description": "Name of the parameter observed or affected (e.g., resource_cost.mana)"
    },
    "value": {
      "description": "Value of the parameter, if applicable"
    },
    "context": {
      "type": "object",
      "description": "Optional contextual information (e.g., level, affinity, class)",
      "additionalProperties": true
    },
    "inference": {
      "type": "object",
      "required": [
        "derived_from",
        "justification",
        "confidence"
      ],
      "properties": {
        "derived_from": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "justification": {
          "type": "string"
        },
        "confidence": {
          "type": "string",
          "enum": [
            "low",
            "medium",
            "high"
          ]
        }
      },
      "additionalProperties": false
    },
    "source_ref": {
      "$ref": "https://primal-hunter.local/schemas/shared/provenance.schema.json#/$defs/source_ref_array",
      "description": "Where this change was observed in canon"
    }
  },
  "additionalProperties": false
}
