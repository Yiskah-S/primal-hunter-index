{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://primal-hunter.local/schemas/timeline_event.schema.json",
  "title": "Timeline Event",
  "$comment": "See docs/contracts/timeline_contract_v1.0.md#3-required-fields",
  "type": "object",
  "required": [
    "event_id",
    "scene_id",
    "order",
    "type",
    "source_ref"
  ],
  "properties": {
    "event_id": {
      "allOf": [
        {
          "$ref": "https://primal-hunter.local/schemas/shared/id.schema.json"
        },
        {
          "pattern": "^ev\\."
        }
      ],
      "description": "Stable event identifier (ev.<character>.<scene>.<slug>)."
    },
    "scene_id": {
      "type": "string",
      "pattern": "^\\d{2}-\\d{2}-\\d{2}$",
      "description": "Canonical scene identifier (BB-CC-SS)."
    },
    "order": {
      "type": "integer",
      "minimum": 1,
      "description": "1-based ordering of events within the scene."
    },
    "type": {
      "type": "string",
      "enum": [
        "insight_gained",
        "belief_corrected",
        "memory_lost",
        "information_received",
        "skill_acquired",
        "skill_upgraded",
        "class_changed",
        "title_granted",
        "quest_completed",
        "combat_action",
        "item_crafted",
        "location_discovered",
        "system_message_broadcast",
        "conversation",
        "training_session",
        "deal_made",
        "bond_formed",
        "correction"
      ],
      "description": "Controlled event category per the timeline contract."
    },
    "source_ref": {
      "$ref": "https://primal-hunter.local/schemas/shared/provenance.schema.json#/$defs/source_ref_array",
      "description": "Provenance citations for this event."
    },
    "tags": {
      "type": "array",
      "description": "Semantic tags applied to this event; must map to the tag registry.",
      "items": {
        "type": "string",
        "pattern": "^tag\\.[a-z0-9_]+(\\.[a-z0-9_]+)*$"
      },
      "uniqueItems": true
    },
    "notes": {
      "type": "string",
      "description": "Optional human-readable commentary for the event."
    },
    "related_to": {
      "type": "array",
      "description": "References to other timeline events that relate to this entry.",
      "items": {
        "allOf": [
          {
            "$ref": "https://primal-hunter.local/schemas/shared/id.schema.json"
          },
          {
            "pattern": "^ev\\."
          }
        ]
      },
      "uniqueItems": true
    },
    "skill_id": {
      "allOf": [
        {
          "$ref": "https://primal-hunter.local/schemas/shared/id.schema.json"
        },
        {
          "pattern": "^sn\\."
        }
      ],
      "description": "Associated skill node identifier (sn.*) when applicable."
    },
    "family_id": {
      "allOf": [
        {
          "$ref": "https://primal-hunter.local/schemas/shared/id.schema.json"
        },
        {
          "pattern": "^sf\\."
        }
      ],
      "description": "Associated skill family identifier (sf.*) when applicable."
    },
    "class_id": {
      "allOf": [
        {
          "$ref": "https://primal-hunter.local/schemas/shared/id.schema.json"
        },
        {
          "pattern": "^cl\\."
        }
      ],
      "description": "Class identifier referenced by the event."
    },
    "equipment_id": {
      "allOf": [
        {
          "$ref": "https://primal-hunter.local/schemas/shared/id.schema.json"
        },
        {
          "pattern": "^eq\\."
        }
      ],
      "description": "Equipment identifier referenced by the event."
    },
    "location_id": {
      "allOf": [
        {
          "$ref": "https://primal-hunter.local/schemas/shared/id.schema.json"
        },
        {
          "pattern": "^loc\\."
        }
      ],
      "description": "Location identifier referenced by the event."
    },
    "character_ids": {
      "type": "array",
      "description": "Additional characters involved in the event (pc.* IDs).",
      "items": {
        "allOf": [
          {
            "$ref": "https://primal-hunter.local/schemas/shared/id.schema.json"
          },
          {
            "pattern": "^pc\\."
          }
        ]
      },
      "uniqueItems": true
    },
    "observed_params": {
      "type": "object",
      "description": "Inline quantitative or qualitative observations captured by the event.",
      "patternProperties": {
        "^[a-z0-9_.]+$": {
          "type": [
            "number",
            "string",
            "boolean"
          ]
        }
      },
      "additionalProperties": false
    },
    "payload": {
      "type": "object",
      "description": "Event-specific payload for contract-aligned downstream tooling.",
      "additionalProperties": true
    }
  },
  "additionalProperties": false
}
